!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["json-convert"]=t()}(this,function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=["string","number","boolean","null","object","array"],i=function(e){return null===e?null:-1!==r.indexOf(t(e))?t(e):"string"},b=function(e){return h(e)&&-1!==r.indexOf(e.type)},h=function(e){return null!==e&&!f(e)&&"object"===t(e)},s=function(e){return"function"==typeof e},f=function(e){return Array.isArray(e)},d=function(e){return f(e)&&0===e.length},y=function(e){return h(e)&&d(Object.keys(e))},g=function(e,t){for(var r in e)if(e[r]===t)return!0;return!1},v=function(e,t){return h(e)&&e.hasOwnProperty(t)},O=function(e,t){for(var r in e)e.hasOwnProperty(r)&&t.call(e,e[r],r,e)},x=function(e){return!(!h(e)||!h(e.properties)||"object"!==e.type)},j=function(e){return!(!h(e)||!h(e.items)||"array"!==e.type)},S=function(){return Object.assign.apply(this,arguments)};function q(e,m){m=S({},q.config,m);function d(e,t){if(void 0!==e)return t=t||{},f(e)?r(e,t):h(e)?n(e,t):t.type=i(e),t}var r=function(e,t){t.type="array";t=t.items={};e.length&&d(e[0],t)},n=function(e,t){if(b(e))return S(n=t,r=e),"object"===n.type&&(delete n.properties,r.properties&&d(r.properties,n)),void("array"===n.type&&(delete n.items,n.items={},r.items&&d(r.items,n.items)));var r,n,i,u,o,s,f,a,c,p,l;for(i in t.type="object",t.required=[],t.properties={},e)e.hasOwnProperty(i)&&(o=e[u=i],s=t.properties[u]={},f=m.aliasSign,l=m.requiredSign,a=m.allRequired,c="",-1!==(p=u.indexOf(f))&&(delete t.properties[u],c=u.substr(p+f.length),u=u.substr(0,p),s=t.properties[u]={}),(l=u[0]===l)&&(delete t.properties[u],u=u.substr(1),s=t.properties[u]={},t.required.push(u)),a&&(l||t.required.push(u)),c&&(s.alias=c),s.name=u,y(s),d(o,s))},y=function(e){for(var t in e)e.hasOwnProperty(t)&&(g(e.attributes,t)||(e["@"+t]=e[t],delete e[t]));return e},t=Object.assign({title:m.title,description:m.description},q.baseSchema);return Object.assign(t,d(e))}function P(e,t,i){if(!t)return e;i=S({},P.config,i);function a(e){return q.getAttribute(e,"alias")||q.getAttribute(e,"name")}var r,n,u=new A,c=function(e,t){var r=q.getAttribute(t,"enums");if(!d(r)){var n,i=a(t);for(n in r){var u=r[n];if(u.name===e[i])return void(e[i]=u.value)}}},p=function(e,t){var r=e[a(t)],n=q.getAttribute(t,"filter")||i.filters[t.type];return s(n)?n.call(u,r,e,t):r},l=function r(e){if(v(e,"default"))return e.default;var t=i.defaults;if(t.hasOwnProperty(e.type))return t[e.type];if(j(e))return[];if(x(e)){if(y(e.properties))return{};var n={};return O(e.properties,function(e,t){n[t]=r(e)}),n}},o=function u(o,s){if(o=h(o)?o:{},!x(s))return o;if(y(s.properties))return o;var t,f={};return O(s.properties,function(e,t){var r,n,i=a(e);v(o,i)?(r=o,i=a(n=e),n=v(r,i)?(c(r,n),p(r,n)):l(n),x(e)?f[t]=u(n,e):j(e)?f[t]=m(n,e):f[t]=n):g(s.required,t)&&(f[t]=l(e))}),i.redundancy&&(t=JSON.parse(JSON.stringify(o)),O(s.properties,function(e){e=a(e);v(o,e)&&delete t[e]}),S(f,t)),f},m=function(e,t){if(e=f(e)?e:[],!j(t))return e;return d(e)?[]:x(t.items)?e.map(function(e){return o(e,t.items)}):e};return r=e,y(n=t)?r:(b(n)||(n=new q(n)),x(n)?o(r,n):j(n)?m(r,n):void 0)}function A(e,t,r){if(!(this instanceof A))return P(e,t,r)}return q.baseSchema={id:"http://json-schema.org/draft-04/schema#",$schema:"http://json-schema.org/draft-04/schema#",title:"",description:""},q.setAttribute=function(e,t,r){return g(this.attributes,t)?e[t]=r:e["@"+t]=r,e},q.getAttribute=function(e,t){return g(this.attributes,t)?e[t]:e["@"+t]},q.attributes=["$schema","title","description","type","properties","required","minimum","exclusiveMinimum","maximum","exclusiveMaximum","multipleOf","maxLength","minLength","pattern","maxProperties","minProperties","additionalProperties","items","minItems","maxItem","uniqueItems","additionalProperties","Dependencies","patternProperties","maxLength","minLength","pattern","format","minimum","exclusiveMinimum","maximum","exclusiveMaximum","multipleOf","$ref","definitions","allOf","anyOf","oneOf","not","default"],P.config={defaults:{string:"",number:0,boolean:!(q.config={title:"",description:"",requiredSign:"*",aliasSign:"@",allRequired:!1}),null:null},filters:{string:function(e){return g([void 0,null],e)?"":String(e)},number:function(e){return g([void 0,null,""],e)?0:Number(e)},boolean:function(e){return"true"===e||("false"===e||!g(["0",""],e)&&Boolean(e))},null:function(e){return null===e?e:null},array:function(e){return f(e)?e:[]},object:function(e){return h(e)?e:{}}},redundancy:!1},A.version="1.1.0",A.schema=q,A.convert=P,A.prototype.version=A.version,A.prototype.schema=A.schema,A.prototype.convert=A.convert,A});
